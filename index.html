<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Teste Rafael Maruta - Front-End Recruitment</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
	<!--link rel="stylesheet" type="text/css" href="css/less/netshoes.css" /-->
	<link rel="stylesheet" type="text/css" href="css/netshoes.min.css" />
	<script src="js/zepto.min.js"></script>
	<script src="js/bower_components/react/react.min.js"></script>
	<script src="js/bower_components/react/react-dom.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
	<script type="text/babel">

	const dir_content = 'content/',
		url_json = 'data/products.json';

	function toSeo(str) {
		var with_accent = 'áàãâäéèêëíìîïóòõôöúùûüçÁÀÃÂÄÉÈÊËÍÌÎÏÓÒÕÖÔÚÙÛÜÇ/',
			no_accent = 'aaaaaeeeeiiiiooooouuuucAAAAAEEEEIIIIOOOOOUUUUC-',
			new_str = '';

		for (var i = 0; i < str.length; i++) {
			if (with_accent.search(str.substr(i, 1)) >= 0) {
				new_str += no_accent.substr(with_accent.search(str.substr(i, 1)), 1);
			} else {
				new_str += str.substr(i, 1);
			};
		};
		return new_str.toLowerCase().replace(/ /g, "-");
	};

	var formatPrice = {
		getObject: function(price) {
			price = price.toFixed(2).toString().split('.');
			return {int: price[0], float: price[1]};
		},
		getInstallments: function(installments, price) {
			return installments > 1 ? (price / installments).toFixed(2).replace('.', ',') : '';
		}
	};

	var ProductsTable = React.createClass({
		getInitialState: function() {
			return {products: []};
		},
		componentWillMount: function() {
			var self = this;

			$.getJSON(url_json, function(data) {
				//console.log(data);
				self.setState({products: data.products})
			});
		},
		addToCart: function(id) {
			event.preventDefault();
			this.setState({product: this.state.products[id]});
		},
		render: function() {
			var self = this,
				productRows = this.state.products.map(function (product) {
		            return (
						<li className="col-md-4 col-sm-6 col-xs-12 center-xs">
			            	<a href="#" title={product.title} onClick={() => self.addToCart(product.id)}>
								<TablePhoto image={product.image} title={product.title} description={product.description} />
								<Price currencyFormat={product.currencyFormat} price={product.price} />
								<TableInstallments currencyFormat={product.currencyFormat} price={product.price} installments={product.installments} />
							</a>
						</li>
		            );
		        });

			return (
				<div className="shopping">
					<section id="products" className="col-xs-12">
						<ul className="row">
							{productRows}
						</ul>
					</section>
					<section id="cart" className="col-sm-12 col-md-8">
						<ProductsCart product={this.state.product} />
					</section>
				</div>
			);
		}
	});

	/*var TablePrice = React.createClass({
		componentWillMount: function() {
			var price = formatPrice.getObject(this.props.price);
			this.setState({price: price});
		},
		render: function() {
			return <p className="price">{this.props.currencyFormat} <strong>{this.state.price.int}</strong>,{this.state.price.float}</p>
		}
	});*/

	var Price = React.createClass({
		/*componentWillReceiveProps: function() {
			var price = formatPrice.getObject(this.props.price);
			console.log(price, this.props.quantity);
			this.setState({price: price});
		},
		componentWillMount: function() {
			console.log(2);
			var price = formatPrice.getObject(this.props.price);
			this.setState({price: price});
		},*/
		render: function() {
			var price = formatPrice.getObject(this.props.price);
			return <p className="price">{this.props.currencyFormat} <strong>{price.int}</strong>,{price.float}</p>
		}
	});

	var TablePhoto = React.createClass({
		getInitialState: function() {
			return {image: []};
		},
		componentWillMount: function() {
			var image = dir_content + toSeo(this.props.title) + '.jpg';
			this.setState({image: image});
		},
		render: function() {
			return (
				<figure>
					<img src={this.state.image} alt={this.props.title} />
					<figcaption className="description">{this.props.title} - {this.props.description}</figcaption>
				</figure>
			);
		}
	});

	var TableInstallments = React.createClass({
		getInitialState: function() {
			return {installments: []};
		},
		componentWillMount: function() {
			var installments = formatPrice.getInstallments(this.props.installments, this.props.price);
			this.setState({installments: installments});
		},
		render: function() {
			return <p className="installments">ou {this.props.installments} x <strong>{this.props.currencyFormat} {this.state.installments}</strong></p>
		}
	});

	var ProductsCart = React.createClass({
		getInitialState: function() {
			return {products: [], list: [], over: []};
		},
		mouseOver: function(e) {
			e.setState({over: 'delete'});
			//console.log(e.props.over);
			//this.setState({over: 'delete'})
		},
		render: function() {
			if (typeof this.props.product !== 'undefined') {

				if (this.state.products.indexOf(this.props.product) == -1) {
					this.state.list[this.props.product.id] = 1;
					this.state.products.push(this.props.product);
				} else {
					this.state.list[this.props.product.id]++;
				};

				console.log(this.state.over);
				var self = this,
					cartRows = this.state.products.map(function (product) {
					console.log('self', self.state.over);
		            return (
		            	<li className="row middle-xs {self.state.over}">
							<hr />
							<div className="col-xs-9 start-xs">
								<CartPhoto image={product.image} title={product.title} />
								<h4 className="title">{product.title} {product.description} {self.props.over}</h4>
								<p className="size">{product.availableSizes.join(' ')} | {product.style}</p>
								<p className="quantity">Quantidade: {self.state.list[product.id]}</p>
							</div>
							<div className="col-xs-3 end-xs">
								<a href="#" className="close ico-cancel33" onMouseOver={() => self.mouseOver(self)}></a>
								<Price currencyFormat={product.currencyFormat} price={product.price * self.state.list[product.id]} />
							</div>
						</li>
		            );
		        });
			};

			return (
				<aside>
					<h3 className="cart-title"><span className="bag">3</span>Sacola</h3>
					<ul>
						{cartRows}
						<CartConclude />
					</ul>
				</aside>
			);
		}
	});

	var CartPhoto = React.createClass({
		getInitialState: function() {
			return {image: []};
		},
		componentWillMount: function() {
			var image = dir_content + toSeo(this.props.title) + '_thumb.jpg';
			this.setState({image: image});
		},
		render: function() {
			return (
				<figure className="thumb">
					<img src={this.state.image} alt={this.props.title} />
				</figure>
			);
		}
	});

	var CartConclude = React.createClass({
		render: function() {
			return (
				<li className="row conclude">
					<hr />
					<p className="subtotal col-xs-6 start-xs">Subtotal</p>
					<div className="col-xs-6 end-xs">
						<p className="total-price">R$ <strong>379</strong>,70</p>
						<p className="total-installments">ou em até 10 X <strong>R$ 37,97</strong></p>
					</div>
					<div className="col-xs-12 btn-buy-container">
						<input type="submit" className="btn-buy" value="Comprar" />
					</div>
				</li>
			);
		}
	});
	
	ReactDOM.render(
		<ProductsTable />,
		document.getElementById('container')
	);
	</script>
</head>
<body class="col-xs-12">
	<div class="row center-xs">
		<div id="container">
			<!--section id="products" class="col-xs-12">
				<ul class="row">
					<li class="col-md-4 col-sm-6 col-xs-12 center-xs">
						<a href="#" title="Chuteira Nike">
							<figure>
								<img src="content/foto1.jpg" alt="Chuteira Nike" />
								<figcaption class="description">Chuteira Nike Mercurial Victory 3 FG - Edição Especial Infantil</figcaption>
							</figure>
							<p class="price">R$ <strong>149</strong>,90</p>
							<p class="installments">ou 3 x <strong>R$ 25,00</strong></p>
						</a>
					</li>
					<li class="col-md-4 col-sm-6 col-xs-12 center-xs">
						<a href="#" title="Chuteira Nike">
							<figure>
								<img src="content/foto1.jpg" alt="Chuteira Nike" />
								<figcaption class="description">Chuteira Nike Mercurial Victory 3 FG - Edição Especial Infantil</figcaption>
							</figure>
							<p class="price">R$ <strong>49</strong>,90</p>
							<p class="installments">ou 3 x <strong>R$ 25,00</strong></p>
						</a>
					</li>
					<li class="col-md-4 col-sm-6 col-xs-12 center-xs">
						<a href="#" title="Chuteira Nike">
							<figure>
								<img src="content/foto1.jpg" alt="Chuteira Nike" />
								<figcaption class="description">Chuteira Nike Mercurial Victory 3 FG - Edição Especial Infantil</figcaption>
							</figure>
							<p class="price">R$ <strong>9</strong>,90</p>
							<p class="installments">ou 3 x <strong>R$ 25,00</strong></p>
						</a>
					</li>
					<li class="col-md-4 col-sm-6 col-xs-12 center-xs">
						<a href="#" title="Chuteira Nike">
							<figure>
								<img src="content/foto1.jpg" alt="Chuteira Nike" />
								<figcaption class="description">Chuteira Nike Mercurial Victory 3 FG - Edição Especial Infantil</figcaption>
							</figure>
							<p class="price">R$ <strong>149</strong>,90</p>
							<p class="installments">ou 3 x <strong>R$ 25,00</strong></p>
						</a>
					</li>
					<li class="col-md-4 col-sm-6 col-xs-12 center-xs">
						<a href="#" title="Chuteira Nike">
							<figure>
								<img src="content/foto1.jpg" alt="Chuteira Nike" />
								<figcaption class="description">Chuteira Nike Mercurial Victory 3 FG - Edição Especial Infantil</figcaption>
							</figure>
							<p class="price">R$ <strong>149</strong>,90</p>
							<p class="installments">ou 3 x <strong>R$ 25,00</strong></p>
						</a>
					</li>

				</ul>
			</section>
			<section id="cart" class="col-sm-12 col-md-8">
				<aside>
					<h3 class="cart-title"><span class="bag">3</span>Sacola</h3>
					<ul>
						<li class="row middle-xs delete">
							<hr>
							<div class="col-xs-9 start-xs">
								<figure class="thumb">
									<img src="content/calcao-nike-corinthians_thumb.jpg" alt="Chuteira Nike" />
								</figure>
								<h4 class="title">Chuteira Nike Mercurial Victory 3 FG - Edição Especial Infantil</h4>
								<p class="size">GG | Preto e branco</p>
								<p class="quantity">Quantidade: 2</p>
							</div>
							<div class="col-xs-3 end-xs">
								<a href="#" class="close ico-cancel33"></a>
								<p class="price">R$ <strong>149</strong>,90</p>
							</div>
						</li>
						<li class="row middle-xs">
							<hr>
							<div class="col-xs-9 start-xs">
								<figure class="thumb">
									<img src="content/calcao-nike-strike-lgr-woven_thumb.jpg" alt="Chuteira Nike" />
								</figure>
								<h4 class="title">Chuteira Nike Mercurial Victory 3 FG - Edição Especial Infantil</h4>
								<p class="size">GG | Preto e branco</p>
								<p class="quantity">Quantidade: 2</p>
							</div>
							<div class="col-xs-3 end-xs">
								<a href="#" class="close ico-cancel33"></a>
								<p class="price">R$ <strong>149</strong>,90</p>
							</div>
						</li>
						<li class="row conclude">
							<hr>
							<p class="subtotal col-xs-6 start-xs">Subtotal</p>
							<div class="col-xs-6 end-xs">
								<p class="total-price">R$ <strong>379</strong>,70</p>
								<p class="total-installments">ou em até 10 X <strong>R$ 37,97</strong></p>
							</div>
							<div class="col-xs-12 btn-buy-container">
								<input type="submit" class="btn-buy" value="Comprar" />
							</div>
						</li>
					</ul>
				</aside>
			</section--
		</div>
	</div>
	
</body>
</html>